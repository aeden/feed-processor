#!/usr/bin/env jruby
#
# Description: Fetches the content from the list of URLs provided
# on the command line and stores that content and its response code
# in a MongoDB database.
#
# Usage: jruby -rubygems -Ilib bin/fetch urls.txt
#
# Dependencies:
#
# * jruby-http-reactor
# * beanstalk-client
# * threadify
# * mongo_mapper

require 'uri'
require 'http_reactor'
require 'threadify'
require 'beanstalk-client'
require 'mongomapper'

$stdout.sync = true

MongoMapper.connection = Mongo::Connection.new(nil, nil, :auto_reconnect => true)
MongoMapper.database = 'publishing_platform'

require 'feed_processor'

fetcher = FeedProcessor::Fetcher.new(:threads => 16)
fetcher.execute